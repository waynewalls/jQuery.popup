/**
 *  jQuery.popup plugin -- modal popup, content loaded with AJAX request
 *  Copyright (c) 2010 Wayne Walls - wfwalls(at)gmail(dot)com
 *  License: MIT License or GNU General Public License (GPL) Version 2
 *  Date: 01 September 2010
 *  @author Wayne Walls
 *  @version 0.93
 *
 * DEPENDENCY: jQuery.servercomm plugin
 * [ http://github.com/waynewalls/jquery.servercomm ]
 *
 */
;(function(window,document,$){var
ie=(function(){var undef,v=3,div=document.createElement('div'),all=div.getElementsByTagName('p');do{div.innerHTML='<!--[if gt IE '+(v+=1)+']><p></p><![endif]-->';}
while(all[0]);return v>4?v:undef;}()),styleText=[(ie===6)?"body { background-image: url(images/clear1.gif) fixed; }":"",".ww-popup-matte"+"{ display:none; background-color:black; width:100%; height:100%;",(ie===6)?"position: absolute; left: expression((document.documentElement || document.body).scrollLeft); top: expression((document.documentElement || document.body).scrollTop);":"position:fixed; left:0; top:0px;","}",".ww-popup-container"+"{ display:none; background-color:white; border-bottom:ridge #88afff 4px; overflow:hidden;",(ie===6)?"position: absolute;":"position:fixed;","}",".ww-popup-titlebar { height:25px; background-image:url(images/titlebar.png); }",".ww-popup-title { font-weight:bold; color:white; padding-left:5px; position:relative; top:4px; }",".ww-popup-close { cursor:pointer; padding-right:20px; position:absolute; right:3px; top:4px; background: url(images/close.gif) center right no-repeat; }",".ww-popup-close-label { color:white; text-decoration:underline; position:relative; top:-1px; }"].join(""),styleElement=$('<style />').attr("type","text/css"),popupStorage=[],popupmatte=null,popupContent=null,activepopup=null,getPopUpDimensions=function(){var windowPadTop=75,windowPadBottom=50,maxHeight=$(window).height()-windowPadTop-windowPadBottom,currentHeight=activepopup.outerHeight(),popUpHeight=(currentHeight>maxHeight)?maxHeight:currentHeight;return{top:windowPadTop,height:popUpHeight};},eventHandler_popupClose=function(){var popDims,horizontalPosition,options=$.popup.options;activepopup.remove();activepopup=null;if(popupStorage.length!==0){activepopup=popupStorage.pop();activepopup.appendTo(document.body);horizontalPosition=($(window).width()-activepopup.width())/2;if(ie===6){popDims=getPopUpDimensions();activepopup[0].style.setExpression('top',"(document.documentElement || document.body).scrollTop + "+popDims.top);activepopup[0].style.setExpression('left',"(document.documentElement || document.body).scrollLeft + "+horizontalPosition);}
else{activepopup.css({left:horizontalPosition});}}
else{popupmatte.slideUp("normal",function(){popupmatte.remove();popupmatte=null;});}
if(options.closeCallback&&$.isFunction(options.closeCallback)){options.closeCallback.apply(activepopup?activepopup[0]:null,(options.closeArgs||[null]));}
if(popupStorage.length!==0){$.popup.options=$.extend($.popup.options,popupStorage.pop());}},createPopup=function(){var browserWindow=$(window),options=$.popup.options,popDims,horizontalPosition;activepopup=$("<div />",{"class":"ww-popup-container"}).append($("<div />",{"class":"ww-popup-titlebar"}));activepopup.find("div.ww-popup-titlebar").append($("<span />",{"class":"ww-popup-title",text:options.title})).append($("<span />",{"class":"ww-popup-close","title":"close",html:"<span class='ww-popup-close-label'>close</span>"}).click(eventHandler_popupClose));activepopup.append(popupContent).css("display","block").appendTo(document.body);if(typeof options.width==="number"){activepopup.css("width",options.width);}
else{activepopup.css("width",600);}
if(activepopup.outerWidth()>=browserWindow.width()){activepopup.width(browserWindow.width()-20);popupContent.css("width","auto").css("overflow-x","scroll");}
popDims=getPopUpDimensions();horizontalPosition=(browserWindow.width()-activepopup.width())/2;if(ie===6){activepopup[0].style.setExpression('top',"(document.documentElement || document.body).scrollTop + "+popDims.top);activepopup[0].style.setExpression('left',"(document.documentElement || document.body).scrollLeft + "+horizontalPosition);}
else{activepopup.css("top",popDims.top).css("left",horizontalPosition);}
activepopup.height(popDims.height);popupContent.height(popDims.height-activepopup.find("div:first-child").outerHeight()-(parseInt(popupContent.css("padding-top"),10)+parseInt(popupContent.css("padding-bottom"),10)));if(options.successCallback&&$.isFunction(options.successCallback)){options.successCallback.apply(activepopup[0],(options.successArgs||[null]));}};$(window).bind("resize.ww-popup-event",function(){var browserWindow=$(window),horizontalPosition;if(popupmatte){horizontalPosition=(browserWindow.width()-activepopup.width())/2;if(ie===6){activepopup[0].style.setExpression('left',"(document.documentElement || document.body).scrollLeft + "+horizontalPosition);popupmatte.css({width:browserWindow.width(),height:browserWindow.height()});}
else{activepopup.css({left:horizontalPosition});}}});$(document).ready(function(){if(styleElement[0].styleSheet){styleElement[0].styleSheet.cssText=styleText;}
else{styleElement.text(styleText);}
styleElement.prependTo("head");});$.popup={optionDefaults:{url:"",title:"",width:600,successCallback:null,successArgs:null,closeCallback:null,closeArgs:null},options:{url:"",title:"",width:600,successCallback:null,successArgs:null,closeCallback:null,closeArgs:null},configure:function(config){config=config||{};this.optionDefaults=$.extend(this.optionDefaults,config);},popupOpen:function(){return(activepopup!==null);},show:function(config){var browserWindow=$(window),temp={};if(activepopup){popupStorage.push($.extend(temp,this.options));popupStorage.push(activepopup.detach());}
config=config||{};this.options=$.extend({},this.optionDefaults,config);$.serverComm.contactServer({url:$.popup.options.url,method:"GET",successCallback:function(response){popupContent=$(response.split("|")[1]);if(popupmatte===null){popupmatte=$("<div />",{"class":"ww-popup-matte",css:{opacity:0.70}}).appendTo(document.body);if(ie===6){popupmatte.css({height:browserWindow.height(),width:browserWindow.width()});}
popupmatte.slideDown("normal",createPopup);}
else{createPopup();}}});}};}(window,document,jQuery));